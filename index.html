<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROK í—Œë²• Ai </title>
    <style>
        /* From Uiverse.io by Lakshay-art */ 
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #000000 0%, #1a0a2e 50%, #2d1b69 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        .grid {
            display: none; /* ì²´í¬ë¬´ëŠ¬ ì œê±° */
        }

        .white,
        .border,
        .darkBorderBg,
        .glow {
            max-height: 70px;
            max-width: 314px;
            height: 100%;
            width: 100%;
            position: absolute;
            overflow: hidden;
            z-index: -1;
            /* Border Radius */
            border-radius: 12px;
            filter: blur(3px);
        }

        .input {
            background-color: rgba(1, 2, 1, 0.9);
            border: none;
            width: 301px;
            height: 56px;
            border-radius: 10px;
            color: #ffffff;
            padding-inline: 59px;
            font-size: 18px;
            font-weight: 500;
            text-shadow: 0 0 1px rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        #poda {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input::placeholder {
            color: rgba(192, 185, 192, 0.8);
            font-weight: 400;
        }

        .input:focus {
            outline: none;
        }

        #input-mask {
            display: none; /* ì…ë ¥ ë§ˆìŠ¤í¬ ì™„ì „ ì œê±° */
        }

        #pink-mask {
            pointer-events: none;
            width: 30px;
            height: 20px;
            position: absolute;
            background: #cf30aa;
            top: 10px;
            left: 5px;
            filter: blur(20px);
            opacity: 0.8;
            transition: all 2s;
        }

        #main:hover > #pink-mask {
            opacity: 0;
        }

        .white {
            max-height: 63px;
            max-width: 307px;
            border-radius: 10px;
            filter: blur(2px);
        }

        .white::before {
            content: "";
            z-index: -2;
            text-align: center;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(83deg);
            position: absolute;
            width: 600px;
            height: 600px;
            background-repeat: no-repeat;
            background-position: 0 0;
            filter: brightness(1.4);
            background-image: conic-gradient(
                rgba(0, 0, 0, 0) 0%,
                #a099d8,
                rgba(0, 0, 0, 0) 8%,
                rgba(0, 0, 0, 0) 50%,
                #dfa2da,
                rgba(0, 0, 0, 0) 58%
            );
            transition: all 2s;
        }

        .border {
            max-height: 59px;
            max-width: 303px;
            border-radius: 11px;
            filter: blur(0.5px);
        }

        .border::before {
            content: "";
            z-index: -2;
            text-align: center;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(70deg);
            position: absolute;
            width: 600px;
            height: 600px;
            filter: brightness(1.3);
            background-repeat: no-repeat;
            background-position: 0 0;
            background-image: conic-gradient(
                #1c191c,
                #402fb5 5%,
                #1c191c 14%,
                #1c191c 50%,
                #cf30aa 60%,
                #1c191c 64%
            );
            transition: all 2s;
        }

        .darkBorderBg {
            max-height: 65px;
            max-width: 312px;
        }

        .darkBorderBg::before {
            content: "";
            z-index: -2;
            text-align: center;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(82deg);
            position: absolute;
            width: 600px;
            height: 600px;
            background-repeat: no-repeat;
            background-position: 0 0;
            background-image: conic-gradient(
                rgba(0, 0, 0, 0),
                #18116a,
                rgba(0, 0, 0, 0) 10%,
                rgba(0, 0, 0, 0) 50%,
                #6e1b60,
                rgba(0, 0, 0, 0) 60%
            );
            transition: all 2s;
        }

        #poda:hover > .darkBorderBg::before {
            transform: translate(-50%, -50%) rotate(262deg);
        }

        #poda:hover > .glow::before {
            transform: translate(-50%, -50%) rotate(240deg);
        }

        #poda:hover > .white::before {
            transform: translate(-50%, -50%) rotate(263deg);
        }

        #poda:hover > .border::before {
            transform: translate(-50%, -50%) rotate(250deg);
        }

        #poda:hover > .darkBorderBg::before {
            transform: translate(-50%, -50%) rotate(-98deg);
        }

        #poda:hover > .glow::before {
            transform: translate(-50%, -50%) rotate(-120deg);
        }

        #poda:hover > .white::before {
            transform: translate(-50%, -50%) rotate(-97deg);
        }

        #poda:hover > .border::before {
            transform: translate(-50%, -50%) rotate(-110deg);
        }

        #poda:focus-within > .darkBorderBg::before {
            transform: translate(-50%, -50%) rotate(442deg);
            transition: all 4s;
        }

        #poda:focus-within > .glow::before {
            transform: translate(-50%, -50%) rotate(420deg);
            transition: all 4s;
        }

        #poda:focus-within > .white::before {
            transform: translate(-50%, -50%) rotate(443deg);
            transition: all 4s;
        }

        #poda:focus-within > .border::before {
            transform: translate(-50%, -50%) rotate(430deg);
            transition: all 4s;
        }

        .glow {
            overflow: hidden;
            filter: blur(30px);
            opacity: 0.4;
            max-height: 130px;
            max-width: 354px;
        }

        .glow:before {
            content: "";
            z-index: -2;
            text-align: center;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(60deg);
            position: absolute;
            width: 999px;
            height: 999px;
            background-repeat: no-repeat;
            background-position: 0 0;
            /*border color, change middle color*/
            background-image: conic-gradient(
                #000,
                #402fb5 5%,
                #000 38%,
                #000 50%,
                #cf30aa 60%,
                #000 87%
            );
            transition: all 2s;
        }

        @keyframes rotate {
            100% {
                transform: translate(-50%, -50%) rotate(450deg);
            }
        }

        @keyframes leftright {
            0% {
                transform: translate(0px, 0px);
                opacity: 1;
            }

            49% {
                transform: translate(250px, 0px);
                opacity: 0;
            }
            80% {
                transform: translate(-40px, 0px);
                opacity: 0;
            }

            100% {
                transform: translate(0px, 0px);
                opacity: 1;
            }
        }

        #filter-icon {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            max-height: 40px;
            max-width: 38px;
            height: 100%;
            width: 100%;
            isolation: isolate;
            overflow: hidden;
            /* Border Radius */
            border-radius: 10px;
            background: linear-gradient(180deg, #161329, black, #1d1b4b);
            border: 1px solid transparent;
        }

        .filterBorder {
            height: 42px;
            width: 40px;
            position: absolute;
            overflow: hidden;
            top: 7px;
            right: 7px;
            border-radius: 10px;
        }

        .filterBorder::before {
            content: "";
            text-align: center;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(90deg);
            position: absolute;
            width: 600px;
            height: 600px;
            background-repeat: no-repeat;
            background-position: 0 0;
            filter: brightness(1.35);
            background-image: conic-gradient(
                rgba(0, 0, 0, 0),
                #3d3a4f,
                rgba(0, 0, 0, 0) 50%,
                rgba(0, 0, 0, 0) 50%,
                #3d3a4f,
                rgba(0, 0, 0, 0) 100%
            );
            animation: rotate 4s linear infinite;
        }

        #main {
            position: relative;
        }

        #search-icon {
            position: absolute;
            left: 20px;
            top: 15px;
            color: rgba(192, 185, 192, 0.9);
            font-size: 20px;
            text-shadow: 0 0 2px rgba(255, 255, 255, 0.2);
        }

        /* ì¶”ê°€ ìŠ¤íƒ€ì¼ */
        .title {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
            text-shadow: 0 0 10px rgba(207, 48, 170, 0.5);
        }

        .subtitle {
            color: #c0b9c0;
            text-align: center;
            margin-bottom: 50px;
            font-size: 1rem;
        }

        /* ì±—ë´‡ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .chatbot-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chatbot-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .chatbot-container {
            background: rgba(26, 10, 46, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            height: 80vh;
            max-height: 600px;
            border: 1px solid rgba(207, 48, 170, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .chatbot-modal.show .chatbot-container {
            transform: scale(1);
        }

        /* ì±—ë´‡ í—¤ë” */
        .chatbot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(207, 48, 170, 0.2);
            background: rgba(207, 48, 170, 0.1);
            border-radius: 20px 20px 0 0;
        }

        .chatbot-title {
            color: white;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chatbot-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #402fb5, #cf30aa);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1rem;
        }

        .chatbot-close {
            background: none;
            border: none;
            color: #c0b9c0;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .chatbot-close:hover {
            background: rgba(207, 48, 170, 0.1);
            color: #cf30aa;
        }

        /* ì±—ë´‡ ë©”ì‹œì§€ ì˜ì—­ */
        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .chatbot-message {
            display: flex;
            gap: 12px;
            animation: messageSlideIn 0.3s ease;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chatbot-message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .message-avatar.bot {
            background: linear-gradient(135deg, #402fb5, #cf30aa);
            color: white;
        }

        .message-avatar.user {
            background: linear-gradient(135deg, #cf30aa, #402fb5);
            color: white;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message-content.bot {
            background: rgba(207, 48, 170, 0.1);
            color: #c0b9c0;
            border: 1px solid rgba(207, 48, 170, 0.2);
        }

        .message-content.user {
            background: linear-gradient(135deg, #402fb5, #cf30aa);
            color: white;
        }

        /* ì±—ë´‡ ì…ë ¥ ì˜ì—­ */
        .chatbot-input-area {
            padding: 20px;
            border-top: 1px solid rgba(207, 48, 170, 0.2);
            background: rgba(207, 48, 170, 0.05);
            border-radius: 0 0 20px 20px;
        }

        .chatbot-input-container {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .chatbot-input {
            flex: 1;
            background: rgba(1, 2, 1, 0.9);
            border: 1px solid rgba(207, 48, 170, 0.3);
            border-radius: 20px;
            color: #ffffff;
            padding: 12px 16px;
            font-size: 14px;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            backdrop-filter: blur(10px);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        .chatbot-input:focus {
            outline: none;
            border-color: #cf30aa;
            box-shadow: 0 0 0 2px rgba(207, 48, 170, 0.2);
        }

        .chatbot-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .chatbot-input::placeholder {
            color: rgba(192, 185, 192, 0.6);
        }

        .chatbot-send-btn {
            background: linear-gradient(135deg, #402fb5, #cf30aa);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .chatbot-send-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(207, 48, 170, 0.3);
        }

        .chatbot-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜ */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: rgba(207, 48, 170, 0.1);
            border-radius: 18px;
            border: 1px solid rgba(207, 48, 170, 0.2);
            width: fit-content;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #cf30aa;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* ìë£Œë¥¼ ì°¾ëŠ” ì¤‘ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes searching {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .searching-indicator {
            animation: searching 1.5s ease-in-out infinite;
        }

        /* ë³µì‚¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(207, 48, 170, 0.2);
            border: 1px solid rgba(207, 48, 170, 0.3);
            border-radius: 6px;
            color: #c0b9c0;
            padding: 4px 8px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0;
            z-index: 10;
        }

        .message-content:hover .copy-btn {
            opacity: 1;
        }

        .copy-btn:hover {
            background: rgba(207, 48, 170, 0.3);
            color: #ffffff;
            transform: scale(1.05);
        }

        .copy-btn.copied {
            background: rgba(76, 175, 80, 0.3);
            border-color: rgba(76, 175, 80, 0.5);
            color: #4CAF50;
        }

        /* ê³µìœ  ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .share-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #402fb5, #cf30aa);
            border: none;
            border-radius: 8px;
            color: white;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .share-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(207, 48, 170, 0.3);
        }

        .share-btn:active {
            transform: translateY(0);
        }

        /* ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆì— ìƒëŒ€ ìœ„ì¹˜ ì„¤ì • */
        .chatbot-message {
            position: relative;
        }

        .message-content {
            position: relative;
        }

        /* ëŒ€í™” íšŸìˆ˜ í‘œì‹œ */
        .conversation-counter {
            position: absolute;
            top: 20px;
            right: 80px;
            background: rgba(207, 48, 170, 0.2);
            color: #c0b9c0;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            border: 1px solid rgba(207, 48, 170, 0.3);
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        .chatbot-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chatbot-messages::-webkit-scrollbar-track {
            background: rgba(207, 48, 170, 0.1);
            border-radius: 3px;
        }

        .chatbot-messages::-webkit-scrollbar-thumb {
            background: rgba(207, 48, 170, 0.3);
            border-radius: 3px;
        }

        .chatbot-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(207, 48, 170, 0.5);
        }

        /* ì…‹ì—… ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .setup-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #402fb5, #cf30aa);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(207, 48, 170, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .setup-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(207, 48, 170, 0.4);
        }

        .setup-button:active {
            transform: scale(0.95);
        }

        /* ì…‹ì—… íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .setup-panel {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            background: rgba(26, 10, 46, 0.95);
            border: 1px solid rgba(207, 48, 170, 0.3);
            border-radius: 20px;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s ease;
            padding: 25px;
        }

        .setup-panel.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .setup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(207, 48, 170, 0.2);
        }

        .setup-title {
            color: #ffffff;
            font-size: 18px;
            font-weight: 600;
        }

        .setup-close {
            background: none;
            border: none;
            color: #c0b9c0;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .setup-close:hover {
            background: rgba(207, 48, 170, 0.2);
            color: #ffffff;
        }

        .setup-section {
            margin-bottom: 20px;
        }

        .setup-section-title {
            color: #c0b9c0;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .setup-input-group {
            margin-bottom: 15px;
        }

        .setup-label {
            display: block;
            color: #ffffff;
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .setup-input {
            width: 100%;
            background: rgba(1, 2, 1, 0.8);
            border: 1px solid rgba(207, 48, 170, 0.3);
            border-radius: 10px;
            color: #ffffff;
            padding: 10px 12px;
            font-size: 13px;
            backdrop-filter: blur(10px);
            transition: all 0.2s ease;
        }

        .setup-input:focus {
            outline: none;
            border-color: #cf30aa;
            box-shadow: 0 0 0 2px rgba(207, 48, 170, 0.2);
        }

        .setup-input::placeholder {
            color: rgba(192, 185, 192, 0.5);
        }

        .setup-select {
            width: 100%;
            background: rgba(1, 2, 1, 0.8);
            border: 1px solid rgba(207, 48, 170, 0.3);
            border-radius: 10px;
            color: #ffffff;
            padding: 10px 12px;
            font-size: 13px;
            backdrop-filter: blur(10px);
            cursor: pointer;
        }

        .setup-select:focus {
            outline: none;
            border-color: #cf30aa;
        }

        .setup-select option {
            background: rgba(26, 10, 46, 0.95);
            color: #ffffff;
        }

        .setup-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .toggle-label {
            color: #ffffff;
            font-size: 13px;
            font-weight: 500;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: rgba(207, 48, 170, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #cf30aa;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(20px);
        }

        .setup-buttons {
            display: flex;
            gap: 8px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .setup-btn {
            flex: 1;
            min-width: 80px;
            background: linear-gradient(135deg, #402fb5, #cf30aa);
            border: none;
            border-radius: 10px;
            color: white;
            padding: 10px 12px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .setup-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(207, 48, 170, 0.3);
        }

        .setup-btn.secondary {
            background: rgba(207, 48, 170, 0.2);
            border: 1px solid rgba(207, 48, 170, 0.3);
        }

        .setup-btn.secondary:hover {
            background: rgba(207, 48, 170, 0.3);
        }

        .setup-btn.close {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: #ff6b6b;
        }

        .setup-btn.close:hover {
            background: rgba(244, 67, 54, 0.3);
            color: #ffffff;
        }

        .setup-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(207, 48, 170, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(207, 48, 170, 0.2);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
        }

        .status-indicator.error {
            background: #f44336;
        }

        .status-text {
            color: #c0b9c0;
            font-size: 12px;
        }

        .setup-info {
            color: rgba(192, 185, 192, 0.7);
            font-size: 11px;
            line-height: 1.4;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="grid"></div>
    
    <div style="text-align: center; z-index: 10;">
        <h1 class="title">í—Œë²• Ai</h1>
        <p class="subtitle">í•œêµ­ê¸°ë…êµì¥ë¡œíšŒ í—Œë²• ê²€ìƒ‰ ì¸ê³µì§€ëŠ¥ ì„œë¹„ìŠ¤ </p>
        
        <div id="main">
            <div id="poda">
                <div class="glow"></div>
                <div class="darkBorderBg"></div>
                <div class="border"></div>
                <div class="white"></div>
                
                <input type="text" class="input" placeholder="ë¬´ì—‡ì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?" id="search-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                
                <div id="search-icon">ğŸ”</div>
                <div id="input-mask"></div>
                <div id="pink-mask"></div>
                
                <div id="filter-icon">
                    <div class="filterBorder"></div>
                    <span style="color: white; font-size: 14px;">âš™ï¸</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ì±—ë´‡ ëª¨ë‹¬ -->
    <div class="chatbot-modal" id="chatbot-modal">
        <div class="chatbot-container">
            <!-- ì±—ë´‡ í—¤ë” -->
            <div class="chatbot-header">
                <div class="chatbot-title">
                    <div class="chatbot-avatar">AI</div>
                    <span>í—Œë²• AI ì–´ì‹œìŠ¤í„´íŠ¸</span>
                </div>
                <div class="conversation-counter" id="conversation-counter">
                    ëŒ€í™”: 0/10
                </div>
                <button class="chatbot-close" id="chatbot-close">&times;</button>
            </div>

            <!-- ì±—ë´‡ ë©”ì‹œì§€ ì˜ì—­ -->
            <div class="chatbot-messages" id="chatbot-messages">
                <!-- ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>

            <!-- ê³µìœ  ë²„íŠ¼ -->
            <button class="share-btn" id="share-conversation-btn" title="ëŒ€í™” ë‚´ìš© ê³µìœ ">
                ğŸ“¤ ê³µìœ 
            </button>

            <!-- ì±—ë´‡ ì…ë ¥ ì˜ì—­ -->
            <div class="chatbot-input-area">
                <div class="chatbot-input-container">
                    <textarea 
                        class="chatbot-input" 
                        id="chatbot-input" 
                        placeholder="ì¶”ê°€ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."
                        rows="1"
                        autocomplete="off"
                        autocorrect="off"
                        autocapitalize="off"
                        spellcheck="false"
                    ></textarea>
                    <button class="chatbot-send-btn" id="chatbot-send-btn">
                        â¤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì…‹ì—… ë²„íŠ¼ -->
    <button class="setup-button" id="setup-button" title="AI ì„¤ì •">
        âš™ï¸
    </button>

    <!-- ì…‹ì—… íŒ¨ë„ -->
    <div class="setup-panel" id="setup-panel">
        <div class="setup-header">
            <div class="setup-title">AI ì„¤ì •</div>
            <button class="setup-close" id="setup-close">&times;</button>
        </div>

        <!-- API ìƒíƒœ -->
        <div class="setup-status" id="api-status">
            <div class="status-indicator" id="status-indicator"></div>
            <div class="status-text" id="status-text">API ì—°ê²° í™•ì¸ ì¤‘...</div>
        </div>

        <!-- API ì„¤ì • ì„¹ì…˜ -->
        <div class="setup-section">
            <div class="setup-section-title">OpenAI API ì„¤ì •</div>
            
            <div class="setup-input-group">
                <label class="setup-label">API í‚¤</label>
                <input type="password" class="setup-input" id="api-key-input" placeholder="sk-...">
                <div class="setup-info">OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ë³´ì•ˆì„ ìœ„í•´ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.</div>
            </div>

            <div class="setup-input-group">
                <label class="setup-label">ëª¨ë¸ ì„ íƒ</label>
                <select class="setup-select" id="model-select">
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo (ë¹ ë¦„, ì €ë ´)</option>
                    <option value="gpt-4">GPT-4 (ì •í™•í•¨, ë¹„ìŒˆ)</option>
                    <option value="gpt-4-turbo">GPT-4 Turbo (ê· í˜•)</option>
                </select>
            </div>

            <div class="setup-input-group">
                <label class="setup-label">ìµœëŒ€ í† í° ìˆ˜</label>
                <input type="number" class="setup-input" id="max-tokens-input" value="500" min="100" max="2000">
                <div class="setup-info">ì‘ë‹µì˜ ìµœëŒ€ ê¸¸ì´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ë†’ì„ìˆ˜ë¡ ê¸´ ë‹µë³€ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
            </div>

            <div class="setup-input-group">
                <label class="setup-label">ì°½ì˜ì„± (Temperature)</label>
                <input type="range" class="setup-input" id="temperature-input" min="0" max="2" step="0.1" value="0.7">
                <div class="setup-info">0: ì¼ê´€ëœ ë‹µë³€, 2: ì°½ì˜ì ì¸ ë‹µë³€</div>
            </div>
        </div>

        <!-- ëŒ€í™” ì„¤ì • ì„¹ì…˜ -->
        <div class="setup-section">
            <div class="setup-section-title">ëŒ€í™” ì„¤ì •</div>
            
            <div class="setup-input-group">
                <label class="setup-label">ìµœëŒ€ ëŒ€í™” íšŸìˆ˜</label>
                <input type="number" class="setup-input" id="max-conversations-input" value="10" min="5" max="50">
            </div>

            <div class="setup-toggle">
                <span class="toggle-label">ëŒ€í™” ê¸°ë¡ ì €ì¥</span>
                <div class="toggle-switch" id="save-history-toggle">
                    <input type="checkbox" id="save-history-checkbox" style="display: none;">
                </div>
            </div>

            <div class="setup-toggle">
                <span class="toggle-label">íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜</span>
                <div class="toggle-switch active" id="typing-animation-toggle">
                    <input type="checkbox" id="typing-animation-checkbox" checked style="display: none;">
                </div>
            </div>
        </div>

        <!-- í”„ë¡¬í”„íŠ¸ ì„¤ì • ì„¹ì…˜ -->
        <div class="setup-section">
            <div class="setup-section-title">AI í”„ë¡¬í”„íŠ¸ ì„¤ì •</div>
            
            <div class="setup-input-group">
                <label class="setup-label">ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸</label>
                <textarea class="setup-input" id="system-prompt-input" rows="4" placeholder="AIì˜ ì—­í• ê³¼ í–‰ë™ì„ ì •ì˜í•˜ëŠ” í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">ë‹¹ì‹ ì€ í•œêµ­ê¸°ë…êµì¥ë¡œíšŒ í—Œë²• ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•´ í—Œë²•ì— ê·¼ê±°í•˜ì—¬ ì •í™•í•˜ê³  ì¹œê·¼í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”. ë‹µë³€ì€ í•œêµ­ì–´ë¡œ í•˜ë©°, í—Œë²• ì¡°í•­ì„ ì¸ìš©í•  ë•ŒëŠ” êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰í•´ì£¼ì„¸ìš”.</textarea>
            </div>
        </div>

        <!-- ë²„íŠ¼ ì˜ì—­ -->
        <div class="setup-buttons">
            <button class="setup-btn" id="save-settings-btn">ì„¤ì • ì €ì¥</button>
            <button class="setup-btn secondary" id="test-api-btn">API í…ŒìŠ¤íŠ¸</button>
            <button class="setup-btn secondary" id="reset-settings-btn">ì´ˆê¸°í™”</button>
            <button class="setup-btn secondary close" id="close-settings-btn">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // ì±—ë´‡ ìƒíƒœ ê´€ë¦¬
        let isModalOpen = false;
        let isSetupPanelOpen = false;
        let conversationHistory = [];
        let conversationCount = 0;
        let MAX_CONVERSATIONS = 10;

        // AI ì„¤ì • ê´€ë¦¬
        let aiSettings = {
            apiKey: '', // API í‚¤ëŠ” ì‚¬ìš©ìê°€ ì„¤ì •ì—ì„œ ì…ë ¥í•´ì•¼ í•¨
            model: 'gpt-3.5-turbo',
            maxTokens: 500,
            temperature: 0.7,
            systemPrompt: 'ë‹¹ì‹ ì€ í•œêµ­ê¸°ë…êµì¥ë¡œíšŒ í—Œë²• ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•´ í—Œë²•ì— ê·¼ê±°í•˜ì—¬ ì •í™•í•˜ê³  ì¹œê·¼í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”. ë‹µë³€ì€ í•œêµ­ì–´ë¡œ í•˜ë©°, í—Œë²• ì¡°í•­ì„ ì¸ìš©í•  ë•ŒëŠ” êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰í•´ì£¼ì„¸ìš”.',
            saveHistory: false,
            typingAnimation: true
        };

        // ChatGPT API ì„¤ì •
        const OPENAI_API_URL = 'https://api.openai.com/v1/chat/completions';

        // DOM ìš”ì†Œë“¤
        const searchInput = document.getElementById('search-input');
        const chatbotModal = document.getElementById('chatbot-modal');
        const chatbotClose = document.getElementById('chatbot-close');
        const chatbotMessages = document.getElementById('chatbot-messages');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSendBtn = document.getElementById('chatbot-send-btn');
        const conversationCounter = document.getElementById('conversation-counter');

        // ì…‹ì—… íŒ¨ë„ DOM ìš”ì†Œë“¤
        const setupButton = document.getElementById('setup-button');
        const setupPanel = document.getElementById('setup-panel');
        const setupClose = document.getElementById('setup-close');
        const apiKeyInput = document.getElementById('api-key-input');
        const modelSelect = document.getElementById('model-select');
        const maxTokensInput = document.getElementById('max-tokens-input');
        const temperatureInput = document.getElementById('temperature-input');
        const maxConversationsInput = document.getElementById('max-conversations-input');
        const saveHistoryToggle = document.getElementById('save-history-toggle');
        const saveHistoryCheckbox = document.getElementById('save-history-checkbox');
        const typingAnimationToggle = document.getElementById('typing-animation-toggle');
        const typingAnimationCheckbox = document.getElementById('typing-animation-checkbox');
        const systemPromptInput = document.getElementById('system-prompt-input');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const testApiBtn = document.getElementById('test-api-btn');
        const resetSettingsBtn = document.getElementById('reset-settings-btn');
        const closeSettingsBtn = document.getElementById('close-settings-btn');
        const shareConversationBtn = document.getElementById('share-conversation-btn');
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');

        // ChatGPT API í˜¸ì¶œ í•¨ìˆ˜
        async function callChatGPTAPI(userMessage, conversationHistory) {
            try {
                // API í‚¤ í™•ì¸
                if (!checkApiKey()) {
                    throw new Error('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. âš™ï¸ ì„¤ì •ì—ì„œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }

                // ëŒ€í™” ê¸°ë¡ì„ OpenAI í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                const messages = [
                    {
                        role: "system",
                        content: aiSettings.systemPrompt
                    }
                ];

                // ì´ì „ ëŒ€í™” ê¸°ë¡ ì¶”ê°€ (ìµœê·¼ 10ê°œë§Œ)
                const recentHistory = conversationHistory.slice(-10);
                recentHistory.forEach(msg => {
                    if (msg.sender === 'user') {
                        messages.push({
                            role: "user",
                            content: msg.content
                        });
                    } else if (msg.sender === 'bot') {
                        messages.push({
                            role: "assistant",
                            content: msg.content
                        });
                    }
                });

                // í˜„ì¬ ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
                messages.push({
                    role: "user",
                    content: userMessage
                });

                const response = await fetch(OPENAI_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${aiSettings.apiKey}`
                    },
                    body: JSON.stringify({
                        model: aiSettings.model,
                        messages: messages,
                        max_tokens: aiSettings.maxTokens,
                        temperature: aiSettings.temperature,
                        top_p: 1,
                        frequency_penalty: 0,
                        presence_penalty: 0
                    })
                });

                if (!response.ok) {
                    throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    return data.choices[0].message.content.trim();
                } else {
                    throw new Error('API ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜');
                }

            } catch (error) {
                console.error('ChatGPT API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                return `ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”. (ì˜¤ë¥˜: ${error.message})`;
            }
        }

        // í´ë°± ì‘ë‹µ (API ì˜¤ë¥˜ ì‹œ ì‚¬ìš©)
        const fallbackResponses = {
            // í—Œë²• ê´€ë ¨ ì‘ë‹µ
            constitution: [
                "í•œêµ­ê¸°ë…êµì¥ë¡œíšŒ í—Œë²•ì— ë”°ë¥´ë©´, êµíšŒëŠ” ê·¸ë¦¬ìŠ¤ë„ì˜ ëª¸ì´ìš” í•˜ë‚˜ë‹˜ì˜ ë°±ì„±ì˜ ê³µë™ì²´ì…ë‹ˆë‹¤. êµíšŒì˜ ë³¸ì§ˆê³¼ ì‚¬ëª…ì— ëŒ€í•´ ë” ìì„¸íˆ ì•Œê³  ì‹¶ìœ¼ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”.",
                "í—Œë²• ì œ1ì¡°ì—ì„œëŠ” êµíšŒì˜ ì •ì˜ë¥¼ ëª…í™•íˆ í•˜ê³  ìˆìŠµë‹ˆë‹¤. êµíšŒëŠ” ë§ì”€ê³¼ ì„±ë¡€ë¥¼ í†µí•´ ê·¸ë¦¬ìŠ¤ë„ë¥¼ ê³ ë°±í•˜ê³ , í•˜ë‚˜ë‹˜ì˜ ë‚˜ë¼ë¥¼ ì„ í¬í•˜ëŠ” ì„±ë ¹ì˜ ê³µë™ì²´ì…ë‹ˆë‹¤.",
                "í—Œë²•ì— ëª…ì‹œëœ êµíšŒì˜ ì‚¬ëª…ì€ ëª¨ë“  ë¯¼ì¡±ì„ ì œìë¡œ ì‚¼ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” ë§ˆíƒœë³µìŒ 28ì¥ì˜ ëŒ€ìœ„ì„ë ¹ì— ê·¼ê±°í•œ ì¤‘ìš”í•œ ì‚¬ëª…ì…ë‹ˆë‹¤.",
                "êµíšŒì˜ ì¹˜ë¦¬ëŠ” í•˜ë‚˜ë‹˜ì˜ ë§ì”€ì— ë”°ë¼ í–‰í•˜ì—¬ì ¸ì•¼ í•˜ë©°, êµíšŒì˜ ì§ˆì„œì™€ í‰í™”ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•œ ê²ƒì…ë‹ˆë‹¤. ê¶Œì§•ì€ ì‚¬ë‘ì˜ ì •ì‹ ìœ¼ë¡œ í–‰í•˜ì—¬ì ¸ì•¼ í•©ë‹ˆë‹¤."
            ],
            
            // ì¼ë°˜ì ì¸ ëŒ€í™” ì‘ë‹µ
            general: [
                "í¥ë¯¸ë¡œìš´ ì§ˆë¬¸ì´ë„¤ìš”! ë” êµ¬ì²´ì ìœ¼ë¡œ ë§ì”€í•´ ì£¼ì‹œë©´ ë” ì •í™•í•œ ë‹µë³€ì„ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                "ì¢‹ì€ ì§€ì ì…ë‹ˆë‹¤. ì´ ì£¼ì œì— ëŒ€í•´ í—Œë²•ì—ì„œ ì–´ë–»ê²Œ ë‹¤ë£¨ê³  ìˆëŠ”ì§€ í•¨ê»˜ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.",
                "ì´í•´ê°€ ë˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì¶”ê°€ ì§ˆë¬¸ì„ í•´ì£¼ì„¸ìš”. ë” ìì„¸íˆ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.",
                "ì •ë§ ì¤‘ìš”í•œ ì§ˆë¬¸ì´ë„¤ìš”! ì´ëŠ” êµíšŒì˜ ê¸°ë³¸ ì›ë¦¬ì™€ ê´€ë ¨ëœ í•µì‹¬ì ì¸ ë‚´ìš©ì…ë‹ˆë‹¤."
            ],
            
            // ì¥ë¡œ ê´€ë ¨ ì‘ë‹µ
            elder: [
                "ì¥ë¡œëŠ” êµíšŒì˜ ì¹˜ë¦¬ì™€ ëª©ì–‘ì„ ë‹´ë‹¹í•˜ë©°, ë§ì”€ì˜ ì„ í¬ì™€ ì„±ë¡€ì˜ ì§‘í–‰ì„ ê´€ì¥í•©ë‹ˆë‹¤. í—Œë²•ì—ì„œ ì¥ë¡œì˜ ì§ë¬´ì™€ ê¶Œí•œì„ êµ¬ì²´ì ìœ¼ë¡œ ê·œì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
                "ì¥ë¡œëŠ” ê·¸ë¦¬ìŠ¤ë„ì˜ ëŒ€ë¦¬ìë¡œì„œ êµíšŒë¥¼ ì¹˜ë¦¬í•˜ë©°, í•˜ë‚˜ë‹˜ì˜ ë§ì”€ì— ë”°ë¼ êµíšŒì˜ ì§ˆì„œë¥¼ ìœ ì§€í•˜ê³  ì‹ ì•™ì˜ ìˆœê²°ì„ ë³´í˜¸í•©ë‹ˆë‹¤.",
                "ì¥ë¡œ ì„ ì¶œì€ êµíšŒì˜ ì¤‘ìš”í•œ ì¼ì´ë©°, í—Œë²•ì—ì„œ ëª…ì‹œí•œ ìê²©ê³¼ ì ˆì°¨ì— ë”°ë¼ ì§„í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤."
            ],
            
            // ì„±ë¡€ì „ ê´€ë ¨ ì‘ë‹µ
            sacrament: [
                "ì„¸ë¡€ëŠ” ê·¸ë¦¬ìŠ¤ë„ì™€ì˜ ì—°í•©ì„ ìƒì§•í•˜ë©°, ì£„ì˜ ìš©ì„œì™€ ìƒˆ ìƒëª…ì„ ë°›ëŠ” í‘œì‹œì…ë‹ˆë‹¤. í—Œë²•ì—ì„œ ì„¸ë¡€ì˜ ì˜ë¯¸ì™€ ì§‘í–‰ ë°©ë²•ì„ êµ¬ì²´ì ìœ¼ë¡œ ê·œì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
                "ì„±ì°¬ì€ ê·¸ë¦¬ìŠ¤ë„ì˜ ì£½ìŒê³¼ ë¶€í™œì„ ê¸°ë…í•˜ë©°, ê·¸ë¦¬ìŠ¤ë„ì˜ ëª¸ê³¼ í”¼ì— ì°¸ì—¬í•¨ì„ ìƒì§•í•©ë‹ˆë‹¤. ì´ëŠ” êµíšŒì˜ ì—°í•©ê³¼ ì‚¬ë‘ì„ í‘œí˜„í•©ë‹ˆë‹¤.",
                "ì„±ë¡€ì „ì€ êµíšŒì˜ ì¤‘ìš”í•œ ì˜ˆì‹ì´ë©°, í—Œë²•ì—ì„œ ê·¸ ì˜ë¯¸ì™€ ì§‘í–‰ ì ˆì°¨ë¥¼ ëª…í™•íˆ ê·œì •í•˜ê³  ìˆìŠµë‹ˆë‹¤."
            ],
            
            // êµíšŒ ì •ì¹˜ ê´€ë ¨ ì‘ë‹µ
            polity: [
                "êµíšŒì˜ ì¹˜ë¦¬ëŠ” ë¯¼ì£¼ì  ì›ë¦¬ì— ë”°ë¼ í–‰í•˜ì—¬ì ¸ì•¼ í•˜ë©°, ëª¨ë“  ì¤‘ìš”í•œ ê²°ì •ì€ íšŒì˜ë¥¼ í†µí•´ ì´ë£¨ì–´ì ¸ì•¼ í•©ë‹ˆë‹¤.",
                "êµíšŒì˜ ê° ê¸°ê´€ì€ ì„œë¡œ í˜‘ë ¥í•˜ë©°, í•˜ë‚˜ë‹˜ì˜ ì˜ê´‘ì„ ìœ„í•´ ì¼í•´ì•¼ í•©ë‹ˆë‹¤. í—Œë²•ì—ì„œ ì´ëŸ¬í•œ í˜‘ë ¥ ê´€ê³„ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ê·œì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
                "êµíšŒì˜ ëª¨ë“  í–‰ì •ì€ íˆ¬ëª…í•˜ê³  ê³µì •í•˜ê²Œ ì´ë£¨ì–´ì ¸ì•¼ í•˜ë©°, ì´ëŠ” í—Œë²•ì—ì„œ ê°•ì¡°í•˜ëŠ” ì¤‘ìš”í•œ ì›ë¦¬ì…ë‹ˆë‹¤."
            ],
            
            // API ì˜¤ë¥˜ ì‘ë‹µ
            error: [
                "ì£„ì†¡í•©ë‹ˆë‹¤. í˜„ì¬ API ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. âš™ï¸ ì…‹ì—… ë²„íŠ¼ì—ì„œ ì˜¬ë°”ë¥¸ API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.",
                "API ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì„¤ì •ì—ì„œ API í‚¤ë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                "ì¼ì‹œì ì¸ ì„œë¹„ìŠ¤ ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”."
            ]
        };

        function getFallbackResponse(question = '') {
            const lowerQuestion = question.toLowerCase();
            
            // ì§ˆë¬¸ ë‚´ìš©ì— ë”°ë¥¸ ì‘ë‹µ ì„ íƒ
            if (lowerQuestion.includes('í—Œë²•') || lowerQuestion.includes('êµíšŒ') || lowerQuestion.includes('ì •ì˜')) {
                return fallbackResponses.constitution[Math.floor(Math.random() * fallbackResponses.constitution.length)];
            } else if (lowerQuestion.includes('ì¥ë¡œ') || lowerQuestion.includes('ì§ë¬´') || lowerQuestion.includes('ê¶Œí•œ')) {
                return fallbackResponses.elder[Math.floor(Math.random() * fallbackResponses.elder.length)];
            } else if (lowerQuestion.includes('ì„¸ë¡€') || lowerQuestion.includes('ì„±ì°¬') || lowerQuestion.includes('ì„±ë¡€')) {
                return fallbackResponses.sacrament[Math.floor(Math.random() * fallbackResponses.sacrament.length)];
            } else if (lowerQuestion.includes('ì¹˜ë¦¬') || lowerQuestion.includes('ì •ì¹˜') || lowerQuestion.includes('í–‰ì •')) {
                return fallbackResponses.polity[Math.floor(Math.random() * fallbackResponses.polity.length)];
            } else {
                return fallbackResponses.general[Math.floor(Math.random() * fallbackResponses.general.length)];
            }
        }

        function getErrorResponse() {
            return fallbackResponses.error[Math.floor(Math.random() * fallbackResponses.error.length)];
        }

        // ì…‹ì—… íŒ¨ë„ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function openSetupPanel() {
            isSetupPanelOpen = true;
            setupPanel.classList.add('show');
            loadSettingsToUI();
            checkApiStatus();
        }

        function closeSetupPanel() {
            isSetupPanelOpen = false;
            setupPanel.classList.remove('show');
        }

        function loadSettingsToUI() {
            // API í‚¤ëŠ” ë³´ì•ˆì„ ìœ„í•´ ë§ˆìŠ¤í‚¹í•˜ì—¬ í‘œì‹œ
            if (aiSettings.apiKey) {
                const maskedKey = aiSettings.apiKey.substring(0, 7) + '...' + aiSettings.apiKey.substring(aiSettings.apiKey.length - 4);
                apiKeyInput.value = maskedKey;
                apiKeyInput.setAttribute('data-actual-key', aiSettings.apiKey);
            } else {
                apiKeyInput.value = '';
                apiKeyInput.removeAttribute('data-actual-key');
            }
            
            modelSelect.value = aiSettings.model;
            maxTokensInput.value = aiSettings.maxTokens;
            temperatureInput.value = aiSettings.temperature;
            maxConversationsInput.value = MAX_CONVERSATIONS;
            systemPromptInput.value = aiSettings.systemPrompt;
            
            // í† ê¸€ ìŠ¤ìœ„ì¹˜ ì„¤ì •
            saveHistoryCheckbox.checked = aiSettings.saveHistory;
            saveHistoryToggle.classList.toggle('active', aiSettings.saveHistory);
            
            typingAnimationCheckbox.checked = aiSettings.typingAnimation;
            typingAnimationToggle.classList.toggle('active', aiSettings.typingAnimation);
        }

        function saveSettings() {
            // API í‚¤ ìœ íš¨ì„± ê²€ì‚¬
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                alert('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                apiKeyInput.focus();
                return;
            }
            
            if (!isValidApiKey(apiKey)) {
                alert('ì˜¬ë°”ë¥¸ API í‚¤ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. sk-ë¡œ ì‹œì‘í•˜ëŠ” API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                apiKeyInput.focus();
                return;
            }
            
            // ì„¤ì • ì €ì¥
            aiSettings.apiKey = apiKey;
            aiSettings.model = modelSelect.value;
            aiSettings.maxTokens = parseInt(maxTokensInput.value);
            aiSettings.temperature = parseFloat(temperatureInput.value);
            aiSettings.systemPrompt = systemPromptInput.value.trim();
            aiSettings.saveHistory = saveHistoryCheckbox.checked;
            aiSettings.typingAnimation = typingAnimationCheckbox.checked;
            
            MAX_CONVERSATIONS = parseInt(maxConversationsInput.value);
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('aiSettings', JSON.stringify(aiSettings));
            localStorage.setItem('maxConversations', MAX_CONVERSATIONS);
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            updateConversationCounter();
            
            // API ìƒíƒœ í™•ì¸
            checkApiStatus();
            
            alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! API í‚¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function resetSettings() {
            if (confirm('ëª¨ë“  ì„¤ì •ì„ ì´ˆê¸°ê°’ìœ¼ë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ? ì €ì¥ëœ API í‚¤ë„ ì‚­ì œë©ë‹ˆë‹¤.')) {
                aiSettings = {
                    apiKey: '', // API í‚¤ëŠ” ì‚¬ìš©ìê°€ ì„¤ì •ì—ì„œ ì…ë ¥í•´ì•¼ í•¨
                    model: 'gpt-3.5-turbo',
                    maxTokens: 500,
                    temperature: 0.7,
                    systemPrompt: 'ë‹¹ì‹ ì€ í•œêµ­ê¸°ë…êµì¥ë¡œíšŒ í—Œë²• ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•´ í—Œë²•ì— ê·¼ê±°í•˜ì—¬ ì •í™•í•˜ê³  ì¹œê·¼í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”. ë‹µë³€ì€ í•œêµ­ì–´ë¡œ í•˜ë©°, í—Œë²• ì¡°í•­ì„ ì¸ìš©í•  ë•ŒëŠ” êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰í•´ì£¼ì„¸ìš”.',
                    saveHistory: false,
                    typingAnimation: true
                };
                
                MAX_CONVERSATIONS = 10;
                
                loadSettingsToUI();
                localStorage.removeItem('aiSettings');
                localStorage.removeItem('maxConversations');
                
                // API ìƒíƒœ ì—…ë°ì´íŠ¸
                checkApiStatus();
                
                alert('ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤! API í‚¤ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        async function testApiConnection() {
            const originalText = testApiBtn.textContent;
            testApiBtn.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            testApiBtn.disabled = true;
            
            try {
                const testMessage = "ì•ˆë…•í•˜ì„¸ìš”. ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.";
                const response = await callChatGPTAPI(testMessage, []);
                
                if (response.includes('ì£„ì†¡í•©ë‹ˆë‹¤') || response.includes('ì˜¤ë¥˜')) {
                    throw new Error('API ì‘ë‹µ ì˜¤ë¥˜');
                }
                
                alert('API ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ!\n\nì‘ë‹µ: ' + response.substring(0, 100) + '...');
                updateApiStatus(true, 'API ì—°ê²° ì„±ê³µ');
                
            } catch (error) {
                alert('API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨!\n\nì˜¤ë¥˜: ' + error.message);
                updateApiStatus(false, 'API ì—°ê²° ì‹¤íŒ¨');
            } finally {
                testApiBtn.textContent = originalText;
                testApiBtn.disabled = false;
            }
        }

        async function checkApiStatus() {
            try {
                const testMessage = "í…ŒìŠ¤íŠ¸";
                const response = await callChatGPTAPI(testMessage, []);
                
                if (response.includes('ì£„ì†¡í•©ë‹ˆë‹¤') || response.includes('ì˜¤ë¥˜')) {
                    updateApiStatus(false, 'API ì—°ê²° ì‹¤íŒ¨');
                } else {
                    updateApiStatus(true, 'API ì—°ê²° ì„±ê³µ');
                }
            } catch (error) {
                updateApiStatus(false, 'API ì—°ê²° ì‹¤íŒ¨');
            }
        }

        function updateApiStatus(isConnected, message) {
            statusIndicator.className = `status-indicator ${isConnected ? '' : 'error'}`;
            statusText.textContent = message;
        }

        // API í‚¤ ìœ íš¨ì„± ê²€ì‚¬
        function isValidApiKey(apiKey) {
            if (!apiKey || typeof apiKey !== 'string') return false;
            
            // OpenAI API í‚¤ëŠ” sk- ë˜ëŠ” sk-proj-ë¡œ ì‹œì‘í•˜ëŠ” ê¸´ ë¬¸ìì—´
            const openaiPattern = /^sk-[a-zA-Z0-9_-]{32,}$/;
            return openaiPattern.test(apiKey);
        }

        // API í‚¤ ì…ë ¥ ì‹œ ì‹¤ì‹œê°„ ê²€ì¦
        function validateApiKeyInput() {
            const apiKey = apiKeyInput.value.trim();
            const isValid = isValidApiKey(apiKey);
            
            if (apiKey && !isValid) {
                apiKeyInput.style.borderColor = '#f44336';
                apiKeyInput.style.boxShadow = '0 0 0 2px rgba(244, 67, 54, 0.2)';
            } else {
                apiKeyInput.style.borderColor = apiKey ? '#4CAF50' : 'rgba(207, 48, 170, 0.3)';
                apiKeyInput.style.boxShadow = apiKey ? '0 0 0 2px rgba(76, 175, 80, 0.2)' : 'none';
            }
            
            return isValid;
        }

        // API í‚¤ ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ì‹¤ì œ í‚¤ í‘œì‹œ
        function handleApiKeyFocus() {
            const actualKey = apiKeyInput.getAttribute('data-actual-key');
            if (actualKey) {
                apiKeyInput.value = actualKey;
            }
        }

        // API í‚¤ ì…ë ¥ í•„ë“œ ë¸”ëŸ¬ ì‹œ ë§ˆìŠ¤í‚¹
        function handleApiKeyBlur() {
            const actualKey = apiKeyInput.getAttribute('data-actual-key');
            if (actualKey && apiKeyInput.value === actualKey) {
                const maskedKey = actualKey.substring(0, 7) + '...' + actualKey.substring(actualKey.length - 4);
                apiKeyInput.value = maskedKey;
            }
        }

        // API í‚¤ í™•ì¸ í•¨ìˆ˜
        function checkApiKey() {
            if (!aiSettings.apiKey || !isValidApiKey(aiSettings.apiKey)) {
                return false;
            }
            return true;
        }

        // ì„¤ì • ë¡œë“œ
        function loadSettings() {
            const savedSettings = localStorage.getItem('aiSettings');
            const savedMaxConversations = localStorage.getItem('maxConversations');
            
            if (savedSettings) {
                const parsedSettings = JSON.parse(savedSettings);
                aiSettings = { ...aiSettings, ...parsedSettings };
                console.log('ì €ì¥ëœ ì„¤ì •ì„ ë¡œë“œí–ˆìŠµë‹ˆë‹¤:', parsedSettings);
            }
            
            if (savedMaxConversations) {
                MAX_CONVERSATIONS = parseInt(savedMaxConversations);
            }

            // CORS ë¬¸ì œë¡œ ì¸í•´ ì„¤ì • íŒŒì¼ ë¡œë“œ ë¹„í™œì„±í™”
            // loadConfigFile();
        }

        // config.json íŒŒì¼ì—ì„œ ì„¤ì • ë¡œë“œ
        async function loadConfigFile() {
            try {
                const response = await fetch('./config.json');
                if (response.ok) {
                    const config = await response.json();
                    
                    // OpenAI ì„¤ì • ë¡œë“œ
                    if (config.openai) {
                        if (config.openai.apiKey && config.openai.apiKey !== 'your-openai-api-key-here') {
                            aiSettings.apiKey = config.openai.apiKey;
                        }
                        if (config.openai.model) {
                            aiSettings.model = config.openai.model;
                        }
                        if (config.openai.maxTokens) {
                            aiSettings.maxTokens = config.openai.maxTokens;
                        }
                        if (config.openai.temperature !== undefined) {
                            aiSettings.temperature = config.openai.temperature;
                        }
                    }
                    
                    // ì•± ì„¤ì • ë¡œë“œ
                    if (config.app) {
                        if (config.app.maxConversations) {
                            MAX_CONVERSATIONS = config.app.maxConversations;
                        }
                        if (config.app.saveHistory !== undefined) {
                            aiSettings.saveHistory = config.app.saveHistory;
                        }
                        if (config.app.typingAnimation !== undefined) {
                            aiSettings.typingAnimation = config.app.typingAnimation;
                        }
                        if (config.app.systemPrompt) {
                            aiSettings.systemPrompt = config.app.systemPrompt;
                        }
                    }
                    
                    console.log('ì„¤ì • íŒŒì¼ì—ì„œ ì„¤ì •ì„ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.');
                    
                    // ì„¤ì •ì´ ë¡œë“œëœ í›„ UI ì—…ë°ì´íŠ¸
                    if (isSetupPanelOpen) {
                        loadSettingsToUI();
                    }
                }
            } catch (error) {
                console.log('ì„¤ì • íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì›¹ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
            }
        }

        // í…ìŠ¤íŠ¸ ë³µì‚¬ í•¨ìˆ˜
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                return true;
            } catch (err) {
                // í´ë°±: êµ¬í˜• ë¸Œë¼ìš°ì € ì§€ì›
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                const success = document.execCommand('copy');
                document.body.removeChild(textArea);
                return success;
            }
        }

        // ë³µì‚¬ ë²„íŠ¼ ìƒì„±
        function createCopyButton(messageContent, text) {
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.textContent = 'ë³µì‚¬';
            copyBtn.title = 'ë‹µë³€ ë³µì‚¬';
            
            copyBtn.addEventListener('click', async (e) => {
                e.stopPropagation();
                const success = await copyToClipboard(text);
                
                if (success) {
                    copyBtn.textContent = 'ë³µì‚¬ë¨!';
                    copyBtn.classList.add('copied');
                    
                    setTimeout(() => {
                        copyBtn.textContent = 'ë³µì‚¬';
                        copyBtn.classList.remove('copied');
                    }, 2000);
                } else {
                    copyBtn.textContent = 'ì‹¤íŒ¨';
                    setTimeout(() => {
                        copyBtn.textContent = 'ë³µì‚¬';
                    }, 2000);
                }
            });
            
            messageContent.appendChild(copyBtn);
        }

        // ê³µìœ  ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ì—…ë°ì´íŠ¸
        function updateShareButtonVisibility() {
            if (shareConversationBtn) {
                if (conversationHistory.length > 0) {
                    shareConversationBtn.style.display = 'flex';
                } else {
                    shareConversationBtn.style.display = 'none';
                }
            }
        }

        // ëŒ€í™” ë‚´ìš© ê³µìœ 
        async function shareConversation() {
            if (conversationHistory.length === 0) {
                alert('ê³µìœ í•  ëŒ€í™” ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ëŒ€í™” ë‚´ìš© í¬ë§·íŒ…
            let conversationText = 'ğŸ¤– í—Œë²• AI ëŒ€í™” ë‚´ìš©\n\n';
            conversationText += `ğŸ“… ${new Date().toLocaleString('ko-KR')}\n`;
            conversationText += `ğŸ’¬ ì´ ${conversationHistory.length}ê°œì˜ ë©”ì‹œì§€\n\n`;
            conversationText += 'â”€'.repeat(30) + '\n\n';

            conversationHistory.forEach((msg, index) => {
                const sender = msg.sender === 'user' ? 'ğŸ‘¤ ë‚˜' : 'ğŸ¤– AI';
                const time = msg.timestamp ? msg.timestamp.toLocaleTimeString('ko-KR') : '';
                conversationText += `${sender} (${time})\n`;
                conversationText += `${msg.content}\n\n`;
            });

            conversationText += 'â”€'.repeat(30) + '\n';
            conversationText += 'í•œêµ­ê¸°ë…êµì¥ë¡œíšŒ í—Œë²• AI ì„œë¹„ìŠ¤\n';
            conversationText += 'https://prok.org';

            try {
                // Web Share API ì§€ì› í™•ì¸
                if (navigator.share) {
                    await navigator.share({
                        title: 'í—Œë²• AI ëŒ€í™” ë‚´ìš©',
                        text: conversationText,
                        url: window.location.href
                    });
                } else {
                    // í´ë°±: í´ë¦½ë³´ë“œì— ë³µì‚¬
                    const success = await copyToClipboard(conversationText);
                    if (success) {
                        alert('ëŒ€í™” ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    }
                }
            } catch (error) {
                console.error('ê³µìœ  ì˜¤ë¥˜:', error);
                // í´ë°±: í´ë¦½ë³´ë“œì— ë³µì‚¬
                const success = await copyToClipboard(conversationText);
                if (success) {
                    alert('ëŒ€í™” ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    alert('ê³µìœ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            }
        }

        // ëª¨ë‹¬ ì—´ê¸°
        async function openChatbotModal(initialQuestion) {
            // API í‚¤ í™•ì¸
            if (!checkApiKey()) {
                alert('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„¤ì • íŒ¨ë„ì„ ì—´ì–´ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                openSetupPanel();
                return;
            }

            isModalOpen = true;
            conversationCount = 0;
            chatbotModal.classList.add('show');
            updateConversationCounter();
            
            // ì±—ë´‡ ì…ë ¥ì°½ ì´ˆê¸°í™”
            if (chatbotInput) {
                chatbotInput.value = '';
                chatbotInput.placeholder = "ì¶”ê°€ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...";
            }
            
            // ê³µìœ  ë²„íŠ¼ ì´ˆê¸° ìƒíƒœ ì„¤ì •
            updateShareButtonVisibility();
            
            // ì´ˆê¸° ì§ˆë¬¸ê³¼ ë‹µë³€ ì¶”ê°€
            if (initialQuestion) {
                addMessage('user', initialQuestion);
                
                // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
                showTypingIndicator();
                
                // AI ì‘ë‹µ ìƒì„±
                setTimeout(async () => {
                    const aiResponse = await generateAIResponse(initialQuestion);
                    replaceTypingIndicatorWithResponse(aiResponse);
                }, 1000);
            }
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeChatbotModal() {
            isModalOpen = false;
            chatbotModal.classList.remove('show');
            // ëŒ€í™” ê¸°ë¡ ì´ˆê¸°í™”
            conversationHistory = [];
            conversationCount = 0;
            chatbotMessages.innerHTML = '';
            updateConversationCounter();
            
            // ê³µìœ  ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            updateShareButtonVisibility();
            
            // ì…ë ¥ì°½ ì´ˆê¸°í™” ë° í™œì„±í™”
            if (chatbotInput) {
                chatbotInput.value = '';
                chatbotInput.disabled = false;
                chatbotInput.placeholder = "ì¶”ê°€ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...";
            }
            if (chatbotSendBtn) {
                chatbotSendBtn.disabled = false;
            }
        }

        // ë©”ì‹œì§€ ì¶”ê°€
        function addMessage(sender, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chatbot-message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = `message-avatar ${sender}`;
            avatar.textContent = sender === 'bot' ? 'AI' : 'ë‚˜';
            
            const messageContent = document.createElement('div');
            messageContent.className = `message-content ${sender}`;
            messageContent.textContent = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            // AI ë‹µë³€ì— ë³µì‚¬ ë²„íŠ¼ ì¶”ê°€
            if (sender === 'bot') {
                createCopyButton(messageContent, content);
            }
            
            chatbotMessages.appendChild(messageDiv);
            
            // ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€
            conversationHistory.push({ sender, content, timestamp: new Date() });
            
            // ê³µìœ  ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ì—…ë°ì´íŠ¸
            updateShareButtonVisibility();
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chatbot-message';
            typingDiv.id = 'typing-indicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar bot';
            avatar.textContent = 'AI';
            
            const typingContent = document.createElement('div');
            typingContent.className = 'message-content bot searching-indicator';
            typingContent.textContent = 'ìë£Œë¥¼ ì°¾ëŠ” ì¤‘ì…ë‹ˆë‹¤...';
            
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(typingContent);
            
            chatbotMessages.appendChild(typingDiv);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°ë¥¼ AI ì‘ë‹µìœ¼ë¡œ êµì²´
        function replaceTypingIndicatorWithResponse(response) {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                const messageContent = typingIndicator.querySelector('.message-content');
                if (messageContent) {
                    messageContent.textContent = response;
                    // ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì œê±°
                    messageContent.classList.remove('searching-indicator');
                    // ë³µì‚¬ ë²„íŠ¼ ì¶”ê°€
                    createCopyButton(messageContent, response);
                }
                // ID ì œê±°í•˜ì—¬ ì¼ë°˜ ë©”ì‹œì§€ë¡œ ë³€ê²½
                typingIndicator.removeAttribute('id');
            }
        }

        // ëŒ€í™” íšŸìˆ˜ ì—…ë°ì´íŠ¸
        function updateConversationCounter() {
            conversationCounter.textContent = `ëŒ€í™”: ${conversationCount}/${MAX_CONVERSATIONS}`;
        }

        // ChatGPT APIë¥¼ í†µí•œ ì‘ë‹µ ìƒì„±
        async function generateAIResponse(question) {
            try {
                const response = await callChatGPTAPI(question, conversationHistory);
                return response;
            } catch (error) {
                console.error('AI ì‘ë‹µ ìƒì„± ì˜¤ë¥˜:', error);
                
                // API í‚¤ ì˜¤ë¥˜ì¸ ê²½ìš° íŠ¹ë³„í•œ ë©”ì‹œì§€ í‘œì‹œ
                if (error.message.includes('401') || error.message.includes('Unauthorized')) {
                    return getErrorResponse();
                }
                
                // ê¸°íƒ€ ì˜¤ë¥˜ëŠ” ì¼ë°˜ í´ë°± ì‘ë‹µ
                return getFallbackResponse(question);
            }
        }

        // ë©”ì‹œì§€ ì „ì†¡
        async function sendMessage() {
            const message = chatbotInput.value.trim();
            if (!message) return;
            
            // API í‚¤ í™•ì¸
            if (!checkApiKey()) {
                alert('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„¤ì • íŒ¨ë„ì„ ì—´ì–´ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                openSetupPanel();
                return;
            }
            
            if (conversationCount >= MAX_CONVERSATIONS) {
                addMessage('bot', "ì˜¤ëŠ˜ ëŒ€í™”ê°€ ì •ë§ ìœ ìµí–ˆë„¤ìš”! í—Œë²•ì— ëŒ€í•´ ë” ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ë‹¤ì‹œ ì°¾ì•„ì£¼ì„¸ìš”. í•˜ë‚˜ë‹˜ì˜ ì€í˜œê°€ í•¨ê»˜í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤! ğŸ™");
                setTimeout(() => {
                    closeChatbotModal();
                }, 3000);
                return;
            }
            
            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            addMessage('user', message);
            chatbotInput.value = '';
            conversationCount++;
            updateConversationCounter();
            
            // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
            showTypingIndicator();
            
            // AI ì‘ë‹µ ìƒì„±
            setTimeout(async () => {
                if (conversationCount >= MAX_CONVERSATIONS) {
                    // ë§ˆì§€ë§‰ ì‘ë‹µ
                    replaceTypingIndicatorWithResponse("ì˜¤ëŠ˜ ëŒ€í™”ê°€ ì •ë§ ìœ ìµí–ˆë„¤ìš”! í—Œë²•ì— ëŒ€í•´ ë” ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ë‹¤ì‹œ ì°¾ì•„ì£¼ì„¸ìš”. í•˜ë‚˜ë‹˜ì˜ ì€í˜œê°€ í•¨ê»˜í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤! ğŸ™");
                    // ì…ë ¥ì°½ ë¹„í™œì„±í™”
                    chatbotInput.disabled = true;
                    chatbotSendBtn.disabled = true;
                    chatbotInput.placeholder = "ëŒ€í™”ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ëª¨ë‹¬ì„ ë‹«ê³  ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.";
                } else {
                    const aiResponse = await generateAIResponse(message);
                    replaceTypingIndicatorWithResponse(aiResponse);
                }
            }, 1000 + Math.random() * 1000);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const searchTerm = this.value.trim();
                if (searchTerm) {
                    openChatbotModal(searchTerm);
                    this.value = '';
                }
            }
        });

        chatbotClose.addEventListener('click', closeChatbotModal);

        chatbotModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeChatbotModal();
            }
        });

        chatbotSendBtn.addEventListener('click', sendMessage);

        chatbotInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ì…ë ¥ì°½ ìë™ ë†’ì´ ì¡°ì ˆ
        chatbotInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // í•„í„° ì•„ì´ì½˜ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('filter-icon').addEventListener('click', function() {
            alert('í•„í„° ì˜µì…˜ì´ ì—´ë ¸ìŠµë‹ˆë‹¤!\n\ní•„í„° ê¸°ëŠ¥:\nâ€¢ ì¹´í…Œê³ ë¦¬ë³„ í•„í„°\nâ€¢ ë‚ ì§œë³„ ì •ë ¬\nâ€¢ ê´€ë ¨ë„ ìˆœ ì •ë ¬');
        });

        // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ íš¨ê³¼
        searchInput.addEventListener('focus', function() {
            console.log('ê²€ìƒ‰ í•„ë“œì— í¬ì»¤ìŠ¤ë¨');
        });

        // í˜¸ë²„ íš¨ê³¼ ë¡œê·¸
        document.getElementById('poda').addEventListener('mouseenter', function() {
            console.log('ê²€ìƒ‰ í•„ë“œì— ë§ˆìš°ìŠ¤ í˜¸ë²„ë¨');
        });

        // ì…‹ì—… íŒ¨ë„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        setupButton.addEventListener('click', openSetupPanel);
        setupClose.addEventListener('click', closeSetupPanel);
        
        // íŒ¨ë„ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        setupPanel.addEventListener('click', function(e) {
            if (e.target === this) {
                closeSetupPanel();
            }
        });

        // í† ê¸€ ìŠ¤ìœ„ì¹˜ ì´ë²¤íŠ¸
        saveHistoryToggle.addEventListener('click', function() {
            saveHistoryCheckbox.checked = !saveHistoryCheckbox.checked;
            this.classList.toggle('active', saveHistoryCheckbox.checked);
        });

        typingAnimationToggle.addEventListener('click', function() {
            typingAnimationCheckbox.checked = !typingAnimationCheckbox.checked;
            this.classList.toggle('active', typingAnimationCheckbox.checked);
        });

        // ë²„íŠ¼ ì´ë²¤íŠ¸
        saveSettingsBtn.addEventListener('click', saveSettings);
        testApiBtn.addEventListener('click', testApiConnection);
        resetSettingsBtn.addEventListener('click', resetSettings);
        closeSettingsBtn.addEventListener('click', closeSetupPanel);
        shareConversationBtn.addEventListener('click', shareConversation);

        // API í‚¤ ì…ë ¥ ì‹œ ì‹¤ì‹œê°„ ê²€ì¦
        apiKeyInput.addEventListener('input', validateApiKeyInput);
        apiKeyInput.addEventListener('blur', validateApiKeyInput);
        apiKeyInput.addEventListener('focus', handleApiKeyFocus);
        apiKeyInput.addEventListener('blur', handleApiKeyBlur);

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¤ì • ë¡œë“œ
        document.addEventListener('DOMContentLoaded', async function() {
            loadSettings();
            updateConversationCounter();
            
            // ì…ë ¥ì°½ ì´ˆê¸°í™” ë° ìë™ì™„ì„± ë°©ì§€
            clearInputFields();
            
            // API ìƒíƒœ í™•ì¸
            checkApiStatus();
        });

        // ì…ë ¥ì°½ ì´ˆê¸°í™” ë° ìë™ì™„ì„± ë°©ì§€
        function clearInputFields() {
            // ê²€ìƒ‰ì°½ ì´ˆê¸°í™”
            if (searchInput) {
                searchInput.value = '';
                searchInput.setAttribute('autocomplete', 'off');
                searchInput.setAttribute('autocorrect', 'off');
                searchInput.setAttribute('autocapitalize', 'off');
                searchInput.setAttribute('spellcheck', 'false');
            }
            
            // ì±—ë´‡ ì…ë ¥ì°½ ì´ˆê¸°í™”
            if (chatbotInput) {
                chatbotInput.value = '';
                chatbotInput.setAttribute('autocomplete', 'off');
                chatbotInput.setAttribute('autocorrect', 'off');
                chatbotInput.setAttribute('autocapitalize', 'off');
                chatbotInput.setAttribute('spellcheck', 'false');
            }
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì§€ì›
        document.addEventListener('keydown', function(e) {
            // ESC í‚¤ë¡œ ì„¤ì • íŒ¨ë„ ë‹«ê¸°
            if (e.key === 'Escape' && isSetupPanelOpen) {
                closeSetupPanel();
            }
            
            // Ctrl/Cmd + , ë¡œ ì„¤ì • íŒ¨ë„ ì—´ê¸°
            if ((e.ctrlKey || e.metaKey) && e.key === ',') {
                e.preventDefault();
                if (isSetupPanelOpen) {
                    closeSetupPanel();
                } else {
                    openSetupPanel();
                }
            }
        });
    </script>
</body>
</html>
